{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% tailwind_css %}
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—ë–º</title>
</head>

<body id="body">
    <div class="h-screen grid bg-gray-100" style="grid-template-rows: 1fr 9fr;">
        <!-- –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <nav class="w-full flex justify-between items-center bg-white shadow-lg">
            <div class="h-full p-4 flex items-center">
                <h1 class="text-2xl">–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h1>
            </div>
            <div class="h-full p-2 gap-x-2 flex justify-between items-center">
                {% if user.is_staff %}
                <a id="admin_panel" href="{% url 'admin_panel' %}" title="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å" class="p-2 flex items-center text-lg rounded-lg hover:text-primary-700 hover:bg-gray-100 transition">
                    –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                </a>
                {% endif %}
                <a id="inventory" href="{% url 'inventory' %}" title="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å" class="p-2 flex items-center text-lg rounded-lg hover:text-primary-700 hover:bg-gray-100 transition">
                    –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
                </a>
                <a id="help" href="{% url 'help' %}" title="–°–ø—Ä–∞–≤–∫–∞" class="p-2 flex items-center text-lg rounded-lg hover:text-primary-700 hover:bg-gray-100 transition">
                    –°–ø—Ä–∞–≤–∫–∞
                </a>
                {% if user.is_authenticated %}
                <a href="{% url 'profile' %}" title="–ü—Ä–æ—Ñ–∏–ª—å" class="flex justify-center items-center bg-primary-500 text-center text-xl text-white rounded-full hover:bg-primary-700 transition" style="width: 50px; height: 50px;">
                    {{ user.first_name|slice:'0:1' }}{{ user.last_name|slice:'0:1' }}
                </a>
                {% else %}
                <a href="{% url 'profile' %}" title="–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã" class="flex justify-center items-center bg-primary-500 text-center text-xl text-white rounded-full hover:bg-primary-700 transition" style="width: 50px; height: 50px;">
                    ??
                </a>
                {% endif %}
            </div>
        </nav>
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
        <div class="w-full p-10 gap-10 flex justify-center items-start">
            <!-- –°–µ–∫—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π -->
            <div id="scroll-table" class="w-2/3 p-4 grid gap-4 bg-white border rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-center text-primary-600">–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
                <hr>
                <table class="border border-gray-300 border-collapse">
                    <thead>
                        <tr class="bg-gray-50 border border-gray-300">
                            <th class="p-2 text-center">#</th>
                            <th class="p-2 text-start">–ü—Ä–µ–¥–º–µ—Ç</th>
                            <th class="p-2 text-start">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th class="p-2 text-center">–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                            <th class="p-2 text-center">üíæ</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        {% for product in products %}
                        <tr class="border-b border-gray-300 hover:bg-primary-50 transition">
                            <th class="p-2 text-center">{{ forloop.counter }}</th>
                            <td class="p-2 text-start break-all">{{ product.name }}</td>
                            <td class="p-2 text-start">{{ product.quantity|default:"1" }}</td>
                            <td class="p-2">
                                {% if product.state == 'inactive' %}
                                <select name="state" class="px-1 bg-gray-50 border border-gray-300 focus:outline focus:outline-primary-500 transition" required>
                                    <option selected value="inactive">–í –∑–∞–ø–∞—Å–µ</option>
                                    <option value="active">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</option>
                                    <option value="broken">–°–ª–æ–º–∞–Ω</option>
                                </select>
                                {% elif product.state == 'active' %}
                                <select name="state" class="px-1 bg-gray-50 border border-gray-300 focus:outline focus:outline-primary-500 transition" required>
                                    <option value="inactive">–í –∑–∞–ø–∞—Å–µ</option>
                                    <option selected value="active">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</option>
                                    <option value="broken">–°–ª–æ–º–∞–Ω</option>
                                </select>
                                {% elif product.state == 'broken' %}
                                <select name="state" class="px-1 bg-gray-50 border border-gray-300 focus:outline focus:outline-primary-500 transition" required>
                                    <option value="inactive">–í –∑–∞–ø–∞—Å–µ</option>
                                    <option value="active">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</option>
                                    <option selected value="broken">–°–ª–æ–º–∞–Ω</option>
                                </select>
                                {% endif %}
                            </td>
                            <td class="p-2">
                                <button type="submit" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" class="w-full cursor-pointer bg-primary-500 hover:bg-primary-700 text-center text-white rounded transition">
                                    ‚úì
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr class="border-y border-gray-300">
                            <td colspan="4" class="py-2 text-center text-gray-400 transition">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
            <div class="w-1/3 p-4 grid gap-4 bg-white border rounded-lg shadow-lg">
                <h2 class="text-xl font-semibold text-center text-primary-600">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</h2>
                <hr>
                <form method="post" action="{% url 'inventory' %}" class="grid gap-4">
                    {% csrf_token %}
                    <input id="nameInput" type="text" name="name" class="p-2 text-gray-800 placeholder-gray-400 bg-gray-100 border border-gray-300 rounded focus:outline focus:outline-primary-500 transition" placeholder="–ü—Ä–µ–¥–º–µ—Ç" required>
                    <div id="nameLengthError" class="p-2 bg-red-50 text-red-500 text-sm border border-red-500 rounded hidden">
                        –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 256 —Å–∏–º–≤–æ–ª–æ–≤!
                    </div>
                    <input id="quantityInput" type="number" name="quantity" class="p-2 text-gray-800 placeholder-gray-400 bg-gray-100 border border-gray-300 rounded focus:outline focus:outline-primary-500 transition" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" required>
                    <div id="quantityError" class="p-2 bg-red-50 text-red-500 text-sm border border-red-500 rounded hidden">
                        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º!
                    </div>
                    <!-- <select class="p-2 text-gray-800 bg-gray-100 border border-gray-300 rounded focus:outline focus:outline-primary-500 transition" name="state" required>
                            <option value="inactive">–í –∑–∞–ø–∞—Å–µ</option>
                            <option value="active">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</option>
                            <option value="broken">–°–ª–æ–º–∞–Ω</option>
                        </select> -->
                    <div class="px-1 grid gap-1">
                        <p>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</p>
                        <div class="m-0 flex items-center gap-x-2">
                            <input id="inactive" name="state" type="radio" value="inactive" class="relative size-4 appearance-none cursor-pointer rounded-full border border-gray-300 bg-white before:checked:absolute before:checked:inset-1 before:checked:rounded-full before:checked:bg-primary-500 checked:border-primary-500 hover:border-primary-500 focus-visible:outline focus-visible:outline-1 focus-visible:outline-offset-2 focus-visible:outline-primary-500 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400 transition" checked>
                            <label for="inactive" class="block font-md text-lime-500">–í –∑–∞–ø–∞—Å–µ</label>
                        </div>
                        <div class="flex items-center gap-x-2">
                            <input id="active" name="state" type="radio" value="active" class="relative size-4 appearance-none cursor-pointer rounded-full border border-gray-300 bg-white before:checked:absolute before:checked:inset-1 maks:slenderman before:checked:rounded-full before:checked:bg-primary-500 checked:border-primary-500 hover:border-primary-500 focus-visible:outline focus-visible:outline-1 focus-visible:outline-offset-2 focus-visible:outline-primary-500 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400 transition">
                            <label for="inactive" class="block font-md text-blue-500">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</label>
                        </div>
                        <div class="flex items-center gap-x-2">
                            <input id="broken" name="state" type="radio" value="broken" class="relative size-4 appearance-none cursor-pointer rounded-full border border-gray-300 bg-white before:checked:absolute before:checked:inset-1 before:checked:rounded-full before:checked:bg-primary-500 checked:border-primary-500 hover:border-primary-500 focus-visible:outline focus-visible:outline-1 focus-visible:outline-offset-2 focus-visible:outline-primary-500 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400 transition">
                            <label for="inactive" class="block font-md text-red-500">–°–ª–æ–º–∞–Ω–æ</label>
                        </div>
                    </div>
                    <button id="addButton" type="submit" class="p-2 cursor-pointer bg-primary-600 font-semibold text-white rounded-md hover:bg-primary-700 disabled:bg-gray-400 transition" disabled>–î–æ–±–∞–≤–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</body>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const nameInput = document.getElementById("nameInput")
        const nameLengthError = document.getElementById("nameLengthError")
        const quantityInput = document.getElementById("quantityInput")
        const quantityError = document.getElementById("quantityError")
        const addButton = document.getElementById("addButton")

        let logs = [false, false, true]

        console.log(logs)

        nameInput.addEventListener("input", () => {
            const name = nameInput.value

            // –û—à–∏–±–∫–∞ –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏
            if (name.length > 256) {
                nameLengthError.classList.remove("hidden")
                nameInput.classList.add("focus:outline-red-500")
                logs[0] = false
            } else {
                nameLengthError.classList.add("hidden")
                nameInput.classList.remove("focus:outline-red-500")
                logs[0] = true
            }

            switchButton();
        })

        quantityInput.addEventListener("input", () => {
            const quantity = quantityInput.value.trim()

            // –û—à–∏–±–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            if (quantity === "") {
                quantityError.classList.add("hidden")
                quantityInput.classList.remove("focus:outline-red-500")
                logs[1] = false

                return
            }

            const quantityValue = parseFloat(quantity, 10)

            if (isNaN(quantityValue) || quantityValue < 1 || quantityValue % 1 != 0.0) {
                quantityError.classList.remove("hidden")
                quantityInput.classList.add("focus:outline-red-500")
                logs[1] = false
            } else {
                quantityError.classList.add("hidden")
                quantityInput.classList.remove("focus:outline-red-500")
                logs[1] = true
            }

            switchButton();
        });

        function switchButton() {
            if (all(logs)) {
                addButton.disabled = false
            } else {
                addButton.disabled = true
            }
        }

        function all(array) {
            for (let i = 0; i < array.length; i++) {
                if (array[i] === false) {
                    return false
                }
            }

            return true
        }
    });
</script>
<script>
    const path = window.location.pathname;
    const page = path.slice(1, -1);
    const activeButton = document.getElementById(page);

    activeButton.classList.add("bg-gray-100");
</script>
<script>
    const inventoryTableBody = document.getElementById("inventoryTableBody");
    const trs = inventoryTableBody.getElementsByTagName("tr");
    const selects = inventoryTableBody.getElementsByTagName("select");
    const buttons = inventoryTableBody.getElementsByTagName("button");

    for (let i = 0; i < trs.length; i++) {
        selects[i].addEventListener("input", e => rowChanged(trs[i]));
        buttons[i].addEventListener("click", e => rowConfirm(trs[i]));
    }

    function rowChanged(row) {
        row.classList.remove("bg-green-50");
        row.classList.remove("hover:bg-green-100");
        row.classList.remove("hover:bg-primary-50");
        row.classList.add("bg-amber-50");
        row.classList.add("hover:bg-amber-100");
    }

    function rowConfirm(row) {
        row.classList.remove("bg-amber-50");
        row.classList.remove("hover:bg-amber-100");
        row.classList.remove("hover:bg-primary-50");
        row.classList.add("bg-green-50");
        row.classList.add("hover:bg-green-100");
    }
</script>

</html>